<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X√°c th·ª±c 2FA - PhongTro.vn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-md-5">
                <div class="card shadow">
                    <div class="card-body p-5">
                        <h3 class="text-center mb-4">üîí X√°c th·ª±c 2FA</h3>
                        
                        <p class="text-center text-muted mb-4">
                            Nh·∫≠p m√£ 6 s·ªë t·ª´ Google Authenticator
                        </p>
                        
                        {% if messages %}
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                            {% endfor %}
                        {% endif %}

                        <!-- DEBUG INFO - Remove in production -->
                        {% if debug_expected_otp %}
                        <div class="alert alert-warning small">
                            <strong>üîß Debug:</strong> M√£ OTP ƒë√∫ng l√†: <code>{{ debug_expected_otp }}</code><br>
                            <small>N·∫øu m√£ tr√™n ƒëi·ªán tho·∫°i kh√°c, h√£y qu√©t l·∫°i m√£ QR.</small>
                        </div>
                        {% endif %}

                        {% if secret %}
                        <div class="alert alert-info small">
                            <strong>Secret:</strong> <code>{{ secret }}</code><br>
                            <small>Th√™m th·ªß c√¥ng v√†o Google Authenticator n·∫øu m√£ kh√¥ng kh·ªõp.</small>
                        </div>
                        {% endif %}
                        
                        <form method="POST" id="otpForm">
                            {% csrf_token %}

                            <div class="mb-3">
                                <input type="text"
                                       name="otp_code"
                                       id="otp_input"
                                       class="form-control form-control-lg text-center"
                                       placeholder="000000"
                                       maxlength="6"
                                       pattern="[0-9]{6}"
                                       inputmode="numeric"
                                       autocomplete="off"
                                       autofocus
                                       required>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 mb-3">X√°c th·ª±c</button>
                        </form>

                        <div class="text-center">
                            <button type="button" class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#backupCodeForm">
                                S·ª≠ d·ª•ng m√£ d·ª± ph√≤ng
                            </button>
                        </div>

                        <div class="collapse mt-3" id="backupCodeForm">
                            <form method="POST">
                                {% csrf_token %}
                                <div class="card card-body bg-light">
                                    <p class="small text-muted mb-2">Nh·∫≠p m·ªôt trong 10 m√£ d·ª± ph√≤ng c·ªßa b·∫°n:</p>
                                    <input type="text"
                                           name="otp_code"
                                           class="form-control mb-2"
                                           placeholder="XXXXXXXX"
                                           required>
                                    <input type="hidden" name="use_backup" value="true">
                                    <button type="submit" class="btn btn-secondary btn-sm">X√°c th·ª±c b·∫±ng m√£ d·ª± ph√≤ng</button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="text-center mt-4">
                            <a href="{% url 'accounts:logout' %}" class="text-decoration-none">‚Üê Quay l·∫°i ƒëƒÉng nh·∫≠p</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>