{% extends 'base.html' %}

{% block title %}Bảng điều khiển chủ trọ{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="mb-4"><i class="fas fa-tachometer-alt me-2"></i>Bảng điều khiển chủ trọ</h2>
    
    <div class="row mb-4">
        <!-- Stats Cards -->
        <div class="col-md-4 mb-3">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <h3>{{ nhatro_list|length }}</h3>
                    <p class="mb-0">Nhà trọ</p>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a href="{% url 'bookings:manage_nhatro' %}" class="text-white">Quản lý <i class="fas fa-arrow-right"></i></a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card bg-warning text-dark h-100">
                <div class="card-body">
                    <h3>{{ pending_henxem|length }}</h3>
                    <p class="mb-0">Lịch hẹn chờ xác nhận</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <h3>{{ active_rentals|length }}</h3>
                    <p class="mb-0">Phòng đang cho thuê</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Thao tác nhanh</h5>
                </div>
                <div class="card-body">
                    <a href="{% url 'bookings:create_nhatro' %}" class="btn btn-primary me-2">
                        <i class="fas fa-plus me-1"></i>Thêm nhà trọ
                    </a>
                    <a href="{% url 'bookings:manage_nhatro' %}" class="btn btn-outline-primary me-2">
                        <i class="fas fa-list me-1"></i>Quản lý nhà trọ
                    </a>
                    <a href="{% url 'bookings:inbox' %}" class="btn btn-outline-info">
                        <i class="fas fa-envelope me-1"></i>Tin nhắn
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pending Appointments -->
    {% if pending_henxem %}
    <div class="card mb-4">
        <div class="card-header bg-warning">
            <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Lịch hẹn chờ xác nhận</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Khách hàng</th>
                            <th>Phòng</th>
                            <th>Ngày hẹn</th>
                            <th>Ghi chú</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for henxem in pending_henxem %}
                        <tr>
                            <td>{{ henxem.makh.hoten }}<br><small class="text-muted">{{ henxem.makh.email }}</small></td>
                            <td>{{ henxem.mapt.tenpt }}</td>
                            <td>{{ henxem.ngayhen|date:"d/m/Y H:i" }}</td>
                            <td>{{ henxem.ghichu|default:"-" }}</td>
                            <td>
                                <a href="{% url 'bookings:confirm_henxem' pk=henxem.mahxt %}" 
                                   class="btn btn-sm btn-success">
                                    <i class="fas fa-check"></i>
                                </a>
                                <a href="{% url 'bookings:reject_henxem' pk=henxem.mahxt %}" 
                                   class="btn btn-sm btn-danger"
                                   onclick="return confirm('Bạn chắc chắn muốn từ chối?')">
                                    <i class="fas fa-times"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Active Rentals -->
    {% if active_rentals %}
    <div class="card">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="fas fa-home me-2"></i>Phòng đang cho thuê</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Phòng</th>
                            <th>Người thuê</th>
                            <th>Ngày bắt đầu</th>
                            <th>Tiền cọc</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for thuetro in active_rentals %}
                        <tr>
                            <td>{{ thuetro.mapt.tenpt }}</td>
                            <td>{{ thuetro.makh.hoten }}</td>
                            <td>{{ thuetro.ngaybatdau|date:"d/m/Y" }}</td>
                            <td>{{ thuetro.tiencoc|floatformat:0 }} VNĐ</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

