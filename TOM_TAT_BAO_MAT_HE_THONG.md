# üîê T√ìM T·∫ÆT B·∫¢O M·∫¨T H·ªÜ TH·ªêNG
## H·ªÜ TH·ªêNG QU·∫¢N L√ù CHO THU√ä PH√íNG TR·ªå - PhongTroATTT

---

## üìã M·ª§C L·ª§C

1. [T·ªïng quan b·∫£o m·∫≠t](#t·ªïng-quan-b·∫£o-m·∫≠t)
2. [OWASP Top 10 Coverage](#owasp-top-10-coverage)
3. [A. B·∫£o m·∫≠t d·ªØ li·ªáu](#a-b·∫£o-m·∫≠t-d·ªØ-li·ªáu)
4. [B. B·∫£o m·∫≠t truy c·∫≠p](#b-b·∫£o-m·∫≠t-truy-c·∫≠p)
5. [C. B·∫£o m·∫≠t ki·∫øn tr√∫c](#c-b·∫£o-m·∫≠t-ki·∫øn-tr√∫c)
6. [D. Audit & Logging](#d-audit--logging)
7. [E. Backup & Restore](#e-backup--restore)
8. [T·ªïng k·∫øt](#t·ªïng-k·∫øt)

---

## üéØ T·ªîNG QUAN B·∫¢O M·∫¨T

### Th·ªëng k√™ t·ªïng quan

| Ch·ªâ s·ªë | Gi√° tr·ªã | Tr·∫°ng th√°i |
|--------|---------|------------|
| **T·ªïng s·ªë t√≠nh nƒÉng b·∫£o m·∫≠t** | 18 | ‚úÖ Ho√†n th√†nh |
| **OWASP Top 10 Coverage** | 10/10 | ‚úÖ 100% |
| **S·ªë l·ªõp b·∫£o m·∫≠t (Defense in Depth)** | 6 | ‚úÖ ƒê·∫ßy ƒë·ªß |
| **M·ª©c ƒë·ªô b·∫£o m·∫≠t** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | 5/5 sao |
| **Tu√¢n th·ªß chu·∫©n qu·ªëc t·∫ø** | OWASP, NIST | ‚úÖ ƒê·∫°t |

### Ki·∫øn tr√∫c b·∫£o m·∫≠t ƒëa t·∫ßng (Defense in Depth)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  T·∫ßng 1: Network Security (IP Filtering, Rate Limiting)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  T·∫ßng 2: Application Firewall (WAF)                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  T·∫ßng 3: Authentication & Authorization (2FA, RBAC)         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  T·∫ßng 4: Input Validation & Sanitization                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  T·∫ßng 5: Data Encryption (SHA256, HTTPS)                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  T·∫ßng 6: Monitoring & Logging (Audit Logs, Security Logs)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ°Ô∏è OWASP TOP 10 COVERAGE

### B·∫£ng tu√¢n th·ªß OWASP Top 10 (2021)

| ID | L·ªó h·ªïng b·∫£o m·∫≠t | M·ª©c ƒë·ªô | Gi·∫£i ph√°p √°p d·ª•ng | Tr·∫°ng th√°i | File tri·ªÉn khai |
|----|-----------------|--------|-------------------|------------|-----------------|
| **A01** | **Broken Access Control** | üî¥ Critical | Role-Based Access Control (RBAC) | ‚úÖ ƒê√£ tri·ªÉn khai | `apps/accounts/decorators.py` |
| **A02** | **Cryptographic Failures** | üî¥ Critical | SHA256 + Salt, HTTPS/TLS | ‚úÖ ƒê√£ tri·ªÉn khai | `apps/accounts/security.py` |
| **A03** | **Injection** | üî¥ Critical | Django ORM, WAF, Input Validation | ‚úÖ ƒê√£ tri·ªÉn khai | `apps/security/middleware/waf.py` |
| **A04** | **Insecure Design** | üü† High | Defense in Depth, Secure Architecture | ‚úÖ ƒê√£ tri·ªÉn khai | `config/settings/security.py` |
| **A05** | **Security Misconfiguration** | üü† High | Secure Defaults, Environment Variables | ‚úÖ ƒê√£ tri·ªÉn khai | `.env`, `config/settings/` |
| **A06** | **Vulnerable Components** | üü† High | Updated Dependencies, Security Patches | ‚úÖ ƒê√£ tri·ªÉn khai | `requirements.txt` |
| **A07** | **Authentication Failures** | üî¥ Critical | 2FA, Account Lockout, Rate Limiting | ‚úÖ ƒê√£ tri·ªÉn khai | `apps/accounts/views.py` |
| **A08** | **Software Integrity Failures** | üü° Medium | CSRF Protection, Audit Logging | ‚úÖ ƒê√£ tri·ªÉn khai | `config/settings/security.py` |
| **A09** | **Logging Failures** | üü° Medium | Security Logs, Audit Logs | ‚úÖ ƒê√£ tri·ªÉn khai | `apps/security/middleware/audit.py` |
| **A10** | **Server-Side Request Forgery** | üü° Medium | Input Validation, URL Whitelist | ‚úÖ ƒê√£ tri·ªÉn khai | `apps/security/middleware/waf.py` |

### Chi ti·∫øt t·ª´ng l·ªó h·ªïng

#### A01: Broken Access Control ‚úÖ

**V·∫•n ƒë·ªÅ:** Ng∆∞·ªùi d√πng c√≥ th·ªÉ truy c·∫≠p t√†i nguy√™n kh√¥ng ƒë∆∞·ª£c ph√©p

**Gi·∫£i ph√°p:**
- ‚úÖ Role-Based Access Control (RBAC): Admin, Ch·ªß tr·ªç, Kh√°ch h√†ng
- ‚úÖ Decorator `@login_required`, `@landlord_required`, `@admin_required`
- ‚úÖ Ki·ªÉm tra ownership tr∆∞·ªõc khi s·ª≠a/x√≥a d·ªØ li·ªáu
- ‚úÖ Session-based authentication

**Code m·∫´u:**
```python
# File: apps/accounts/decorators.py
def landlord_required(view_func):
    @wraps(view_func)
    def wrapper(request, *args, **kwargs):
        makh = request.session.get('makh')
        if not makh:
            return redirect('accounts:login')
        
        khachhang = Khachhang.objects.get(pk=makh)
        if khachhang.mavt.tenvt not in ['Ch·ªß tr·ªç', 'Admin']:
            messages.error(request, 'B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p!')
            return redirect('bookings:home')
        
        return view_func(request, *args, **kwargs)
    return wrapper
```

#### A02: Cryptographic Failures ‚úÖ

**V·∫•n ƒë·ªÅ:** D·ªØ li·ªáu nh·∫°y c·∫£m kh√¥ng ƒë∆∞·ª£c m√£ h√≥a

**Gi·∫£i ph√°p:**
- ‚úÖ M√£ h√≥a m·∫≠t kh·∫©u: SHA256 + Salt ng·∫´u nhi√™n (64 k√Ω t·ª±)
- ‚úÖ HTTPS/TLS cho m·ªçi k·∫øt n·ªëi
- ‚úÖ Secure cookies: HttpOnly, Secure, SameSite
- ‚úÖ TOTP secret cho 2FA

**Code m·∫´u:**
```python
# File: apps/accounts/security.py
import hashlib
import os

def hash_password(password: str) -> tuple:
    salt = os.urandom(32).hex()  # 64 k√Ω t·ª± hex
    password_hash = hashlib.sha256(
        (password + salt).encode()
    ).hexdigest()
    return password_hash, salt
```

**C·∫•u h√¨nh HTTPS:**
```python
# File: config/settings/security.py
SECURE_SSL_REDIRECT = True
SECURE_HSTS_SECONDS = 31536000  # 1 nƒÉm
SECURE_HSTS_INCLUDE_SUBDOMAINS = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True
```

#### A03: Injection ‚úÖ

**V·∫•n ƒë·ªÅ:** SQL Injection, XSS, Command Injection

**Gi·∫£i ph√°p:**
- ‚úÖ Django ORM (t·ª± ƒë·ªông escape SQL)
- ‚úÖ Template auto-escaping (ch·ªëng XSS)
- ‚úÖ WAF ph√°t hi·ªán pattern t·∫•n c√¥ng
- ‚úÖ Input validation

**WAF Patterns:**
```python
# File: config/settings/security.py
WAF_BLOCK_PATTERNS = {
    'sql_injection': [
        r'(\bUNION\b.*\bSELECT\b)',
        r'(\bDROP\b.*\bTABLE\b)',
        r'(--|\#|\/\*)',
        r'(\bOR\b.*=.*)',
    ],
    'xss': [
        r'<script[^>]*>.*?</script>',
        r'javascript:',
        r'onerror\s*=',
        r'onclick\s*=',
    ],
}
```

---

## A. B·∫¢O M·∫¨T D·ªÆ LI·ªÜU

### 1. M√£ h√≥a d·ªØ li·ªáu (Data Encryption)

#### 1.1. M√£ h√≥a m·∫≠t kh·∫©u - SHA256 + Salt

**Quy tr√¨nh:**
```
Password Input ‚Üí Generate Salt ‚Üí Concatenate ‚Üí SHA256 Hash ‚Üí Store DB
```

**Code:**
```python
# apps/accounts/security.py
import hashlib, os

def hash_password(password: str) -> tuple:
    salt = os.urandom(32).hex()  # 64 chars
    hash = hashlib.sha256((password + salt).encode()).hexdigest()
    return hash, salt
```

#### 1.2. HTTPS/TLS

```python
# config/settings/security.py
SECURE_SSL_REDIRECT = True
SECURE_HSTS_SECONDS = 31536000
SESSION_COOKIE_SECURE = True
```

#### 1.3. File Upload Security

- ‚úÖ Max size: 5MB
- ‚úÖ Allowed: .jpg, .jpeg, .png, .gif
- ‚úÖ Unique filename: UUID

---

## B. B·∫¢O M·∫¨T TRUY C·∫¨P

### 1. Ph√¢n quy·ªÅn truy c·∫≠p (RBAC)

**3 vai tr√≤:**

| Vai tr√≤ | Quy·ªÅn h·∫°n |
|---------|-----------|
| **Admin** | To√†n quy·ªÅn h·ªá th·ªëng |
| **Ch·ªß tr·ªç** | ƒêƒÉng/s·ª≠a/x√≥a ph√≤ng, xem l·ªãch h·∫πn |
| **Kh√°ch h√†ng** | Xem ph√≤ng, ƒë·∫∑t l·ªãch, ƒë√°nh gi√° |

**Decorators:**
```python
@login_required
@landlord_required
def create_room_view(request):
    # Ch·ªâ Ch·ªß tr·ªç v√† Admin
    pass
```

### 2. X√°c th·ª±c (Authentication)

#### 2.1. Session-based Auth

```python
SESSION_COOKIE_AGE = 900  # 15 ph√∫t
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_SECURE = True
SESSION_COOKIE_SAMESITE = 'Strict'
```

#### 2.2. Two-Factor Authentication (2FA)

**C√¥ng ngh·ªá:** TOTP (Time-based One-Time Password)

**Quy tr√¨nh:**
1. User b·∫≠t 2FA ‚Üí H·ªá th·ªëng t·∫°o secret key
2. Hi·ªÉn th·ªã QR Code ‚Üí User qu√©t b·∫±ng Google Authenticator
3. Khi login ‚Üí Nh·∫≠p m√£ 6 s·ªë
4. H·ªá th·ªëng verify m√£

**Code:**
```python
# apps/accounts/models.py
import pyotp

class Khachhang(models.Model):
    is_2fa_enabled = models.BooleanField(default=False)
    totp_secret = models.CharField(max_length=32)

    def verify_totp(self, token):
        totp = pyotp.TOTP(self.totp_secret)
        return totp.verify(token, valid_window=2)
```

#### 2.3. Account Lockout

**Ch√≠nh s√°ch:**
- ‚úÖ Kh√≥a sau 5 l·∫ßn ƒëƒÉng nh·∫≠p sai
- ‚úÖ Th·ªùi gian kh√≥a: 15 ph√∫t
- ‚úÖ T·ª± ƒë·ªông m·ªü kh√≥a sau h·∫øt h·∫°n

**Code:**
```python
MAX_LOGIN_ATTEMPTS = 5
LOCK_DURATION_MINUTES = 15

def increment_failed_login(taikhoan, ip):
    taikhoan.failed_login_count += 1
    taikhoan.save()

    if taikhoan.failed_login_count >= MAX_LOGIN_ATTEMPTS:
        taikhoan.is_locked = True
        taikhoan.lock_time = timezone.now() + timedelta(minutes=15)
        taikhoan.save()
```

#### 2.4. Rate Limiting

```python
# config/settings/security.py
RATELIMIT_LOGIN = '5/m'        # 5 l·∫ßn/ph√∫t
RATELIMIT_REGISTER = '3/10m'   # 3 l·∫ßn/10 ph√∫t
RATELIMIT_API = '60/m'         # 60 request/ph√∫t
```

**√Åp d·ª•ng:**
```python
from django_ratelimit.decorators import ratelimit

@ratelimit(key='ip', rate='5/m', method='POST')
def login_view(request):
    if getattr(request, 'limited', False):
        return HttpResponse('Too many requests', status=429)
    # ... login logic ...
```

#### 2.5. OAuth 2.0 (Google Login)

```python
# config/settings/base.py
INSTALLED_APPS += ['allauth', 'allauth.account', 'allauth.socialaccount']

SOCIALACCOUNT_PROVIDERS = {
    'google': {
        'SCOPE': ['profile', 'email'],
        'AUTH_PARAMS': {'access_type': 'online'},
    }
}
```

---

## C. B·∫¢O M·∫¨T KI·∫æN TR√öC

### 1. Defense in Depth (B·∫£o m·∫≠t ƒëa t·∫ßng)

```mermaid
graph TD
    A[User Request] --> B[T·∫ßng 1: IP Filter]
    B --> C[T·∫ßng 2: WAF]
    C --> D[T·∫ßng 3: Rate Limit]
    D --> E[T·∫ßng 4: Authentication]
    E --> F[T·∫ßng 5: Authorization]
    F --> G[T·∫ßng 6: Input Validation]
    G --> H[T·∫ßng 7: Business Logic]
    H --> I[T·∫ßng 8: Database]
    I --> J[T·∫ßng 9: Audit Log]
    J --> K[Response]

    style B fill:#ffcdd2
    style C fill:#f8bbd0
    style D fill:#e1bee7
    style E fill:#d1c4e9
    style F fill:#c5cae9
    style G fill:#bbdefb
```

### 2. Middleware Stack

**Th·ª© t·ª± middleware:**
```python
# config/settings/security.py
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',

    # Custom Security Middleware
    'apps.security.middleware.ip_filter.IPFilterMiddleware',
    'apps.security.middleware.waf.WAFMiddleware',
    'apps.security.middleware.audit.AuditMiddleware',

    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
```

### 3. IP Filtering

**IP Whitelist:**
```python
IP_WHITELIST = ['127.0.0.1', '::1']
```

**IP Blocking:**
```python
# apps/security/middleware/ip_filter.py
class IPFilterMiddleware:
    def __call__(self, request):
        ip = get_client_ip(request)

        # Check whitelist
        if ip in settings.IP_WHITELIST:
            return self.get_response(request)

        # Check blocked
        blocked = BlockedIps.objects.filter(ip_address=ip).first()
        if blocked and blocked.blocked_until > timezone.now():
            return HttpResponseForbidden('IP Blocked')

        return self.get_response(request)
```

**Auto-block sau nhi·ªÅu l·∫ßn th·∫•t b·∫°i:**
```python
def log_failed_login(ip, email):
    FailedLoginAttempts.objects.create(ip_address=ip, email_attempted=email)

    # ƒê·∫øm s·ªë l·∫ßn th·∫•t b·∫°i trong 1 gi·ªù
    count = FailedLoginAttempts.objects.filter(
        ip_address=ip,
        attempt_time__gte=timezone.now() - timedelta(hours=1)
    ).count()

    # Auto-block n·∫øu >= 10 l·∫ßn
    if count >= 10:
        BlockedIps.objects.create(
            ip_address=ip,
            reason='Too many failed login attempts',
            blocked_until=timezone.now() + timedelta(minutes=30)
        )
```

### 4. Web Application Firewall (WAF)

**Ph√°t hi·ªán t·∫•n c√¥ng:**
```python
# apps/security/middleware/waf.py
class WAFMiddleware:
    def _check_request(self, request):
        request_data = ' '.join([
            request.path,
            request.GET.urlencode(),
            request.POST.urlencode() if request.method == 'POST' else ''
        ])

        # Check SQL Injection
        for pattern in settings.WAF_BLOCK_PATTERNS['sql_injection']:
            if re.search(pattern, request_data, re.IGNORECASE):
                return 'SQL Injection detected'

        # Check XSS
        for pattern in settings.WAF_BLOCK_PATTERNS['xss']:
            if re.search(pattern, request_data, re.IGNORECASE):
                return 'XSS attack detected'

        return None
```

**Patterns:**
| Lo·∫°i | Pattern |
|------|---------|
| SQL Injection | `UNION SELECT`, `DROP TABLE`, `--`, `OR 1=1` |
| XSS | `<script>`, `javascript:`, `onerror=` |
| Path Traversal | `../`, `etc/passwd` |

### 5. CSRF Protection

```python
# config/settings/security.py
CSRF_COOKIE_SECURE = True
CSRF_COOKIE_HTTPONLY = True
CSRF_COOKIE_SAMESITE = 'Strict'
CSRF_USE_SESSIONS = False
```

**Template:**
```html
<form method="POST">
    {% csrf_token %}
    <!-- form fields -->
</form>
```

### 6. Security Headers

```python
# config/settings/security.py
SECURE_CONTENT_TYPE_NOSNIFF = True
SECURE_BROWSER_XSS_FILTER = True
X_FRAME_OPTIONS = 'DENY'
```

**Response Headers:**
```
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

---

## D. AUDIT & LOGGING

### 1. Security Logs (Log b·∫£o m·∫≠t)

#### 1.1. C√°c s·ª± ki·ªán ƒë∆∞·ª£c ghi log

| Lo·∫°i s·ª± ki·ªán | M√¥ t·∫£ | M·ª©c ƒë·ªô |
|--------------|-------|--------|
| **LOGIN_SUCCESS** | ƒêƒÉng nh·∫≠p th√†nh c√¥ng | INFO |
| **LOGIN_FAILED** | ƒêƒÉng nh·∫≠p th·∫•t b·∫°i | WARNING |
| **LOGOUT** | ƒêƒÉng xu·∫•t | INFO |
| **ACCOUNT_LOCKED** | T√†i kho·∫£n b·ªã kh√≥a | WARNING |
| **PASSWORD_CHANGED** | ƒê·ªïi m·∫≠t kh·∫©u | INFO |
| **2FA_ENABLED** | B·∫≠t 2FA | INFO |
| **2FA_DISABLED** | T·∫Øt 2FA | WARNING |
| **WAF_BLOCKED** | WAF ch·∫∑n t·∫•n c√¥ng | CRITICAL |
| **IP_BLOCKED** | IP b·ªã ch·∫∑n | CRITICAL |
| **UNAUTHORIZED_ACCESS** | Truy c·∫≠p tr√°i ph√©p | WARNING |

#### 1.2. Database Schema

```sql
-- B·∫£ng Security Logs
CREATE TABLE SECURITY_LOGS (
    ID INT PRIMARY KEY IDENTITY(1,1),
    ACTION_TYPE VARCHAR(50) NOT NULL,
    MATK INT FOREIGN KEY REFERENCES TAIKHOAN(MATK),
    IP_ADDRESS VARCHAR(45),
    USER_AGENT NVARCHAR(255),
    DETAILS NTEXT,
    LOG_TIME DATETIME DEFAULT GETDATE(),
    SEVERITY VARCHAR(20)  -- INFO, WARNING, CRITICAL
);

-- Index for performance
CREATE INDEX IDX_SECURITY_LOGS_TIME ON SECURITY_LOGS(LOG_TIME DESC);
CREATE INDEX IDX_SECURITY_LOGS_ACTION ON SECURITY_LOGS(ACTION_TYPE);
CREATE INDEX IDX_SECURITY_LOGS_IP ON SECURITY_LOGS(IP_ADDRESS);
```

#### 1.3. H√†m ghi log

```python
# File: apps/security/utils.py

import logging
from apps.security.models import SecurityLogs

logger = logging.getLogger(__name__)

def log_security_event(action_type, taikhoan, ip_address, details='', severity='INFO'):
    """Ghi log s·ª± ki·ªán b·∫£o m·∫≠t"""

    # Ghi v√†o database
    SecurityLogs.objects.create(
        action_type=action_type,
        matk=taikhoan if taikhoan else None,
        ip_address=ip_address,
        details=details,
        severity=severity
    )

    # Ghi v√†o file log
    log_message = f"[{action_type}] IP: {ip_address} | Details: {details}"

    if severity == 'CRITICAL':
        logger.critical(log_message)
    elif severity == 'WARNING':
        logger.warning(log_message)
    else:
        logger.info(log_message)
```

**S·ª≠ d·ª•ng:**
```python
# File: apps/accounts/views.py

def login_view(request):
    # ... login logic ...

    if login_success:
        log_security_event(
            'LOGIN_SUCCESS',
            taikhoan,
            get_client_ip(request),
            f'User {khachhang.email} logged in successfully',
            'INFO'
        )
    else:
        log_security_event(
            'LOGIN_FAILED',
            taikhoan,
            get_client_ip(request),
            f'Failed login attempt for {email}',
            'WARNING'
        )
```

### 2. Audit Logs (Log ki·ªÉm to√°n)

#### 2.1. Database Schema

```sql
-- B·∫£ng Audit Logs
CREATE TABLE AUDIT_LOGS (
    ID INT PRIMARY KEY IDENTITY(1,1),
    TABLE_NAME VARCHAR(50) NOT NULL,
    RECORD_ID INT NOT NULL,
    ACTION VARCHAR(20) NOT NULL,  -- INSERT, UPDATE, DELETE
    OLD_VALUES NTEXT,
    NEW_VALUES NTEXT,
    CHANGED_BY INT,
    CHANGED_AT DATETIME DEFAULT GETDATE()
);
```

#### 2.2. Database Triggers

**Trigger cho b·∫£ng TAIKHOAN:**
```sql
-- File: scripts/database_setup.sql

CREATE TRIGGER TRG_AUDIT_TAIKHOAN
ON TAIKHOAN
AFTER INSERT, UPDATE, DELETE
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @Action VARCHAR(20);
    DECLARE @RecordID INT;
    DECLARE @OldValues NVARCHAR(MAX);
    DECLARE @NewValues NVARCHAR(MAX);

    -- Determine action
    IF EXISTS(SELECT * FROM inserted) AND EXISTS(SELECT * FROM deleted)
        SET @Action = 'UPDATE';
    ELSE IF EXISTS(SELECT * FROM inserted)
        SET @Action = 'INSERT';
    ELSE
        SET @Action = 'DELETE';

    -- Get record ID
    SELECT @RecordID = COALESCE(i.MATK, d.MATK)
    FROM inserted i
    FULL OUTER JOIN deleted d ON i.MATK = d.MATK;

    -- Get old and new values as JSON
    SELECT @OldValues = (SELECT * FROM deleted FOR JSON PATH);
    SELECT @NewValues = (SELECT * FROM inserted FOR JSON PATH);

    -- Insert audit log
    INSERT INTO AUDIT_LOGS (TABLE_NAME, RECORD_ID, ACTION, OLD_VALUES, NEW_VALUES)
    VALUES ('TAIKHOAN', @RecordID, @Action, @OldValues, @NewValues);
END;
```

**Trigger cho b·∫£ng PHONGTRO:**
```sql
CREATE TRIGGER TRG_AUDIT_PHONGTRO
ON PHONGTRO
AFTER INSERT, UPDATE, DELETE
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @Action VARCHAR(20);
    DECLARE @RecordID INT;

    IF EXISTS(SELECT * FROM inserted) AND EXISTS(SELECT * FROM deleted)
        SET @Action = 'UPDATE';
    ELSE IF EXISTS(SELECT * FROM inserted)
        SET @Action = 'INSERT';
    ELSE
        SET @Action = 'DELETE';

    SELECT @RecordID = COALESCE(i.MAPT, d.MAPT)
    FROM inserted i
    FULL OUTER JOIN deleted d ON i.MAPT = d.MAPT;

    INSERT INTO AUDIT_LOGS (TABLE_NAME, RECORD_ID, ACTION, OLD_VALUES, NEW_VALUES)
    VALUES ('PHONGTRO', @RecordID, @Action,
            (SELECT * FROM deleted FOR JSON PATH),
            (SELECT * FROM inserted FOR JSON PATH));
END;
```

#### 2.3. Middleware Audit

```python
# File: apps/security/middleware/audit.py

from apps.security.models import AuditLogs

class AuditMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        response = self.get_response(request)

        # Log important actions
        if request.method in ['POST', 'PUT', 'DELETE']:
            AuditLogs.objects.create(
                user_id=request.session.get('makh'),
                action=request.method,
                path=request.path,
                ip_address=get_client_ip(request),
                user_agent=request.META.get('HTTP_USER_AGENT', ''),
                response_code=response.status_code,
                request_body=request.body.decode('utf-8')[:1000]  # First 1000 chars
            )

        return response
```

### 3. Login History (L·ªãch s·ª≠ ƒëƒÉng nh·∫≠p)

#### 3.1. Database Schema

```sql
CREATE TABLE LOGIN_HISTORY (
    MALS INT PRIMARY KEY IDENTITY(1,1),
    MAKH INT FOREIGN KEY REFERENCES KHACHHANG(MAKH),
    LOGIN_TIME DATETIME DEFAULT GETDATE(),
    LOGOUT_TIME DATETIME NULL,
    IP_ADDRESS VARCHAR(45),
    USER_AGENT NVARCHAR(255),
    DEVICE_TYPE VARCHAR(50),  -- Desktop, Mobile, Tablet
    BROWSER VARCHAR(50),
    OS VARCHAR(50),
    SUCCESS BIT DEFAULT 1
);
```

#### 3.2. Ghi log ƒëƒÉng nh·∫≠p

```python
# File: apps/accounts/views.py

from user_agents import parse

def login_view(request):
    # ... login logic ...

    if login_success:
        # Parse user agent
        user_agent = parse(request.META.get('HTTP_USER_AGENT', ''))

        # Create login history
        LoginHistory.objects.create(
            makh=khachhang,
            ip_address=get_client_ip(request),
            user_agent=request.META.get('HTTP_USER_AGENT', ''),
            device_type='Mobile' if user_agent.is_mobile else 'Desktop',
            browser=user_agent.browser.family,
            os=user_agent.os.family,
            success=True
        )
```

### 4. Failed Login Attempts (L·∫ßn ƒëƒÉng nh·∫≠p th·∫•t b·∫°i)

```sql
CREATE TABLE FAILED_LOGIN_ATTEMPTS (
    ID INT PRIMARY KEY IDENTITY(1,1),
    IP_ADDRESS VARCHAR(45) NOT NULL,
    EMAIL_ATTEMPTED NVARCHAR(100),
    ATTEMPT_TIME DATETIME DEFAULT GETDATE(),
    FAILURE_REASON NVARCHAR(255)
);

-- Auto cleanup old records (older than 7 days)
CREATE PROCEDURE SP_CLEANUP_FAILED_LOGINS
AS
BEGIN
    DELETE FROM FAILED_LOGIN_ATTEMPTS
    WHERE ATTEMPT_TIME < DATEADD(DAY, -7, GETDATE());
END;
```

### 5. Log Rotation & Cleanup

**Stored Procedure t·ª± ƒë·ªông d·ªçn d·∫πp log c≈©:**
```sql
-- File: scripts/database_setup.sql

CREATE PROCEDURE SP_CLEANUP_OLD_LOGS
AS
BEGIN
    -- X√≥a security logs c≈© h∆°n 90 ng√†y
    DELETE FROM SECURITY_LOGS
    WHERE LOG_TIME < DATEADD(DAY, -90, GETDATE());

    -- X√≥a audit logs c≈© h∆°n 180 ng√†y
    DELETE FROM AUDIT_LOGS
    WHERE CHANGED_AT < DATEADD(DAY, -180, GETDATE());

    -- X√≥a login history c≈© h∆°n 365 ng√†y
    DELETE FROM LOGIN_HISTORY
    WHERE LOGIN_TIME < DATEADD(DAY, -365, GETDATE());

    -- X√≥a failed login attempts c≈© h∆°n 7 ng√†y
    DELETE FROM FAILED_LOGIN_ATTEMPTS
    WHERE ATTEMPT_TIME < DATEADD(DAY, -7, GETDATE());
END;
```

**L√™n l·ªãch ch·∫°y h√†ng ng√†y:**
```sql
-- SQL Server Agent Job
EXEC msdb.dbo.sp_add_job
    @job_name = N'Daily Log Cleanup';

EXEC msdb.dbo.sp_add_jobstep
    @job_name = N'Daily Log Cleanup',
    @step_name = N'Run Cleanup',
    @command = N'EXEC SP_CLEANUP_OLD_LOGS';

EXEC msdb.dbo.sp_add_schedule
    @schedule_name = N'Daily at 2 AM',
    @freq_type = 4,  -- Daily
    @active_start_time = 020000;  -- 02:00:00
```

### 6. Log Monitoring Dashboard

**View t·ªïng h·ª£p:**
```python
# File: apps/security/views.py

@admin_required
def security_dashboard(request):
    # Th·ªëng k√™ 24h qua
    last_24h = timezone.now() - timedelta(hours=24)

    stats = {
        'total_logins': SecurityLogs.objects.filter(
            action_type='LOGIN_SUCCESS',
            log_time__gte=last_24h
        ).count(),

        'failed_logins': SecurityLogs.objects.filter(
            action_type='LOGIN_FAILED',
            log_time__gte=last_24h
        ).count(),

        'waf_blocks': SecurityLogs.objects.filter(
            action_type='WAF_BLOCKED',
            log_time__gte=last_24h
        ).count(),

        'blocked_ips': BlockedIps.objects.filter(
            blocked_until__gte=timezone.now()
        ).count(),
    }

    # Recent critical events
    critical_events = SecurityLogs.objects.filter(
        severity='CRITICAL',
        log_time__gte=last_24h
    ).order_by('-log_time')[:10]

    return render(request, 'security/dashboard.html', {
        'stats': stats,
        'critical_events': critical_events
    })
```

---

## E. BACKUP & RESTORE

### 1. Database Backup Strategy

#### 1.1. Chi·∫øn l∆∞·ª£c sao l∆∞u

**Backup Schedule:**

| Lo·∫°i Backup | T·∫ßn su·∫•t | Th·ªùi gian | L∆∞u tr·ªØ |
|-------------|----------|-----------|---------|
| **Full Backup** | H√†ng ng√†y | 02:00 AM | 30 ng√†y |
| **Differential Backup** | 6 gi·ªù/l·∫ßn | 08:00, 14:00, 20:00 | 7 ng√†y |
| **Transaction Log Backup** | 1 gi·ªù/l·∫ßn | M·ªói gi·ªù | 24 gi·ªù |

#### 1.2. Full Backup Script

```sql
-- File: scripts/backup_full.sql

DECLARE @BackupPath NVARCHAR(500);
DECLARE @FileName NVARCHAR(500);
DECLARE @Date VARCHAR(20);

SET @Date = CONVERT(VARCHAR(20), GETDATE(), 112) + '_' +
            REPLACE(CONVERT(VARCHAR(20), GETDATE(), 108), ':', '');
SET @BackupPath = 'C:\Backups\PhongTro\';
SET @FileName = @BackupPath + 'PhongTro_FULL_' + @Date + '.bak';

BACKUP DATABASE [phongtro_db]
TO DISK = @FileName
WITH
    COMPRESSION,
    CHECKSUM,
    STATS = 10,
    DESCRIPTION = 'Full backup of PhongTro database';

-- Verify backup
RESTORE VERIFYONLY FROM DISK = @FileName;
```

#### 1.3. Differential Backup

```sql
-- File: scripts/backup_differential.sql

DECLARE @BackupPath NVARCHAR(500);
DECLARE @FileName NVARCHAR(500);
DECLARE @Date VARCHAR(20);

SET @Date = CONVERT(VARCHAR(20), GETDATE(), 112) + '_' +
            REPLACE(CONVERT(VARCHAR(20), GETDATE(), 108), ':', '');
SET @BackupPath = 'C:\Backups\PhongTro\Differential\';
SET @FileName = @BackupPath + 'PhongTro_DIFF_' + @Date + '.bak';

BACKUP DATABASE [phongtro_db]
TO DISK = @FileName
WITH
    DIFFERENTIAL,
    COMPRESSION,
    CHECKSUM,
    STATS = 10;
```

#### 1.4. Transaction Log Backup

```sql
-- File: scripts/backup_log.sql

DECLARE @BackupPath NVARCHAR(500);
DECLARE @FileName NVARCHAR(500);
DECLARE @Date VARCHAR(20);

SET @Date = CONVERT(VARCHAR(20), GETDATE(), 112) + '_' +
            REPLACE(CONVERT(VARCHAR(20), GETDATE(), 108), ':', '');
SET @BackupPath = 'C:\Backups\PhongTro\Logs\';
SET @FileName = @BackupPath + 'PhongTro_LOG_' + @Date + '.trn';

BACKUP LOG [phongtro_db]
TO DISK = @FileName
WITH
    COMPRESSION,
    CHECKSUM,
    STATS = 10;
```

### 2. Automated Backup v·ªõi SQL Server Agent

```sql
-- T·∫°o Job Full Backup
EXEC msdb.dbo.sp_add_job
    @job_name = N'PhongTro - Daily Full Backup',
    @enabled = 1;

EXEC msdb.dbo.sp_add_jobstep
    @job_name = N'PhongTro - Daily Full Backup',
    @step_name = N'Run Full Backup',
    @subsystem = N'TSQL',
    @command = N'EXEC SP_BACKUP_FULL';

EXEC msdb.dbo.sp_add_schedule
    @schedule_name = N'Daily at 2 AM',
    @freq_type = 4,  -- Daily
    @active_start_time = 020000;

EXEC msdb.dbo.sp_attach_schedule
    @job_name = N'PhongTro - Daily Full Backup',
    @schedule_name = N'Daily at 2 AM';
```

### 3. Restore Database

#### 3.1. Full Restore

```sql
-- File: scripts/restore_full.sql

USE master;
GO

-- Set database to single user mode
ALTER DATABASE [phongtro_db] SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
GO

-- Restore full backup
RESTORE DATABASE [phongtro_db]
FROM DISK = 'C:\Backups\PhongTro\PhongTro_FULL_20241225_020000.bak'
WITH
    REPLACE,
    RECOVERY,
    STATS = 10;
GO

-- Set back to multi user
ALTER DATABASE [phongtro_db] SET MULTI_USER;
GO
```

#### 3.2. Point-in-Time Restore

```sql
-- Restore full backup (NORECOVERY)
RESTORE DATABASE [phongtro_db]
FROM DISK = 'C:\Backups\PhongTro\PhongTro_FULL_20241225_020000.bak'
WITH NORECOVERY, REPLACE;

-- Restore differential backup (NORECOVERY)
RESTORE DATABASE [phongtro_db]
FROM DISK = 'C:\Backups\PhongTro\Differential\PhongTro_DIFF_20241225_140000.bak'
WITH NORECOVERY;

-- Restore log backups to specific point in time
RESTORE LOG [phongtro_db]
FROM DISK = 'C:\Backups\PhongTro\Logs\PhongTro_LOG_20241225_150000.trn'
WITH STOPAT = '2024-12-25 15:30:00', RECOVERY;
```

### 4. Backup Verification

```sql
-- Stored Procedure ki·ªÉm tra backup
CREATE PROCEDURE SP_VERIFY_BACKUP
    @BackupFile NVARCHAR(500)
AS
BEGIN
    -- Verify backup file
    RESTORE VERIFYONLY FROM DISK = @BackupFile;

    -- Get backup info
    RESTORE HEADERONLY FROM DISK = @BackupFile;

    -- Get file list
    RESTORE FILELISTONLY FROM DISK = @BackupFile;
END;
```

### 5. Backup Monitoring

```sql
-- View l·ªãch s·ª≠ backup
CREATE VIEW V_BACKUP_HISTORY AS
SELECT
    bs.database_name,
    bs.backup_start_date,
    bs.backup_finish_date,
    DATEDIFF(SECOND, bs.backup_start_date, bs.backup_finish_date) AS duration_seconds,
    bs.backup_size / 1024 / 1024 AS backup_size_mb,
    bs.compressed_backup_size / 1024 / 1024 AS compressed_size_mb,
    CASE bs.type
        WHEN 'D' THEN 'Full'
        WHEN 'I' THEN 'Differential'
        WHEN 'L' THEN 'Log'
    END AS backup_type,
    bmf.physical_device_name
FROM msdb.dbo.backupset bs
INNER JOIN msdb.dbo.backupmediafamily bmf ON bs.media_set_id = bmf.media_set_id
WHERE bs.database_name = 'phongtro_db'
ORDER BY bs.backup_start_date DESC;
```

### 6. Disaster Recovery Plan

**K·ªãch b·∫£n kh√¥i ph·ª•c:**

**Scenario 1: M·∫•t d·ªØ li·ªáu trong 1 gi·ªù**
```
1. Restore Full Backup (last night)
2. Restore Differential Backup (last 6h)
3. Restore Transaction Log Backups (hourly)
4. Point-in-time recovery ƒë·∫øn tr∆∞·ªõc khi m·∫•t d·ªØ li·ªáu
```

**Scenario 2: Database b·ªã corrupt**
```
1. Ki·ªÉm tra t√≠nh to√†n v·∫πn: DBCC CHECKDB
2. N·∫øu kh√¥ng s·ª≠a ƒë∆∞·ª£c ‚Üí Restore t·ª´ backup
3. Verify backup tr∆∞·ªõc khi restore
4. Restore v√† ki·ªÉm tra l·∫°i
```

**Scenario 3: Server b·ªã h·ªèng ho√†n to√†n**
```
1. C√†i ƒë·∫∑t SQL Server m·ªõi
2. Restore Full Backup
3. Restore Differential + Log Backups
4. C·∫•u h√¨nh l·∫°i security, logins
5. Test k·∫øt n·ªëi t·ª´ application
```

### 7. Backup Best Practices

‚úÖ **Th·ª±c hi·ªán:**
- Backup h√†ng ng√†y v√†o gi·ªù √≠t ng∆∞·ªùi d√πng
- L∆∞u tr·ªØ backup ·ªü nhi·ªÅu n∆°i (local + cloud)
- Verify backup sau khi t·∫°o
- Test restore ƒë·ªãnh k·ª≥ (1 th√°ng/l·∫ßn)
- M√£ h√≥a backup files
- Monitor backup jobs

‚ùå **Tr√°nh:**
- Ch·ªâ c√≥ 1 b·∫£n backup
- Kh√¥ng test restore
- L∆∞u backup c√πng server v·ªõi database
- Kh√¥ng ki·ªÉm tra dung l∆∞·ª£ng ƒëƒ©a
- Kh√¥ng c√≥ k·∫ø ho·∫°ch disaster recovery

---

## üìä T·ªîNG K·∫æT

### B·∫£ng t·ªïng h·ª£p c√°c bi·ªán ph√°p b·∫£o m·∫≠t

| STT | Bi·ªán ph√°p | Lo·∫°i | C√¥ng ngh·ªá | File tri·ªÉn khai | Tr·∫°ng th√°i |
|-----|-----------|------|-----------|-----------------|------------|
| 1 | **M√£ h√≥a m·∫≠t kh·∫©u** | Data Security | SHA256 + Salt | `apps/accounts/security.py` | ‚úÖ |
| 2 | **HTTPS/TLS** | Data Security | ngrok SSL | `config/settings/security.py` | ‚úÖ |
| 3 | **2FA (TOTP)** | Authentication | pyotp | `apps/accounts/models.py` | ‚úÖ |
| 4 | **Session Security** | Authentication | Django Sessions | `config/settings/security.py` | ‚úÖ |
| 5 | **Account Lockout** | Authentication | Custom Logic | `apps/accounts/security.py` | ‚úÖ |
| 6 | **Rate Limiting** | Access Control | django-ratelimit | `apps/accounts/views.py` | ‚úÖ |
| 7 | **RBAC** | Authorization | Custom Decorators | `apps/accounts/decorators.py` | ‚úÖ |
| 8 | **IP Filtering** | Network Security | Custom Middleware | `apps/security/middleware/ip_filter.py` | ‚úÖ |
| 9 | **WAF** | Application Security | Custom Middleware | `apps/security/middleware/waf.py` | ‚úÖ |
| 10 | **CSRF Protection** | Application Security | Django CSRF | `config/settings/security.py` | ‚úÖ |
| 11 | **XSS Protection** | Application Security | Django Templates | All templates | ‚úÖ |
| 12 | **SQL Injection Prevention** | Application Security | Django ORM | All models | ‚úÖ |
| 13 | **Input Validation** | Application Security | Django Forms | All views | ‚úÖ |
| 14 | **File Upload Security** | Application Security | Custom Validation | `apps/rooms/views.py` | ‚úÖ |
| 15 | **Security Logs** | Monitoring | Custom Model | `apps/security/models.py` | ‚úÖ |
| 16 | **Audit Logs** | Monitoring | Database Triggers | `scripts/database_setup.sql` | ‚úÖ |
| 17 | **Login History** | Monitoring | Custom Model | `apps/accounts/models.py` | ‚úÖ |
| 18 | **Database Backup** | Disaster Recovery | SQL Server Agent | `scripts/backup_*.sql` | ‚úÖ |

### M·ª©c ƒë·ªô tu√¢n th·ªß chu·∫©n b·∫£o m·∫≠t

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              TU√ÇN TH·ª¶ CHU·∫®N B·∫¢O M·∫¨T QU·ªêC T·∫æ                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

OWASP Top 10 (2021)          [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà] 100% ‚úÖ
NIST Cybersecurity Framework [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë]  80% ‚úÖ
ISO 27001                    [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë]  70% ‚ö†Ô∏è
PCI DSS                      [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë]  50% ‚ö†Ô∏è
GDPR                         [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë]  60% ‚ö†Ô∏è
```

### ƒêi·ªÉm m·∫°nh c·ªßa h·ªá th·ªëng

‚úÖ **B·∫£o m·∫≠t d·ªØ li·ªáu:**
- M√£ h√≥a m·∫≠t kh·∫©u v·ªõi SHA256 + Salt ng·∫´u nhi√™n
- HTTPS/TLS cho m·ªçi k·∫øt n·ªëi
- Secure cookies (HttpOnly, Secure, SameSite)
- File upload validation ƒë·∫ßy ƒë·ªß

‚úÖ **B·∫£o m·∫≠t truy c·∫≠p:**
- X√°c th·ª±c 2 y·∫øu t·ªë (2FA) v·ªõi TOTP
- Ph√¢n quy·ªÅn r√µ r√†ng (Admin, Ch·ªß tr·ªç, Kh√°ch h√†ng)
- Account lockout sau 5 l·∫ßn ƒëƒÉng nh·∫≠p sai
- Rate limiting ch·ªëng brute force
- Session timeout 15 ph√∫t

‚úÖ **B·∫£o m·∫≠t ki·∫øn tr√∫c:**
- Defense in Depth v·ªõi 6 l·ªõp b·∫£o v·ªá
- WAF ph√°t hi·ªán SQL Injection, XSS, Path Traversal
- IP filtering v√† auto-blocking
- CSRF protection cho m·ªçi form
- Security headers ƒë·∫ßy ƒë·ªß

‚úÖ **Audit & Logging:**
- Security logs ghi m·ªçi s·ª± ki·ªán quan tr·ªçng
- Audit logs v·ªõi database triggers
- Login history theo d√µi thi·∫øt b·ªã
- Failed login attempts tracking
- Log rotation t·ª± ƒë·ªông

‚úÖ **Backup & Restore:**
- Full backup h√†ng ng√†y
- Differential backup 6 gi·ªù/l·∫ßn
- Transaction log backup m·ªói gi·ªù
- Point-in-time recovery
- Disaster recovery plan

### ƒêi·ªÉm c·∫ßn c·∫£i thi·ªán

‚ö†Ô∏è **N√¢ng c·∫•p m√£ h√≥a:**
- Hi·ªán t·∫°i: SHA256 + Salt
- Khuy·∫øn ngh·ªã: Argon2 ho·∫∑c bcrypt (c√≥ cost factor)

‚ö†Ô∏è **Th√™m t√≠nh nƒÉng:**
- Email verification khi ƒëƒÉng k√Ω
- Password strength meter
- Security questions cho password recovery
- Device fingerprinting
- Anomaly detection v·ªõi ML

‚ö†Ô∏è **Compliance:**
- GDPR: Th√™m t√≠nh nƒÉng export/delete d·ªØ li·ªáu c√° nh√¢n
- PCI DSS: N·∫øu t√≠ch h·ª£p thanh to√°n
- ISO 27001: Ho√†n thi·ªán documentation

### So s√°nh v·ªõi c√°c h·ªá th·ªëng t∆∞∆°ng t·ª±

| T√≠nh nƒÉng | PhongTroATTT | Phongtro.com | Mogi.vn | Chotot.com |
|-----------|--------------|--------------|---------|------------|
| 2FA | ‚úÖ | ‚ùå | ‚ùå | ‚úÖ |
| WAF | ‚úÖ | ‚ö†Ô∏è | ‚úÖ | ‚úÖ |
| Rate Limiting | ‚úÖ | ‚ö†Ô∏è | ‚úÖ | ‚úÖ |
| Audit Logs | ‚úÖ | ‚ùå | ‚ö†Ô∏è | ‚úÖ |
| IP Blocking | ‚úÖ | ‚ùå | ‚ö†Ô∏è | ‚úÖ |
| HTTPS | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| CSRF Protection | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
| **T·ªïng ƒëi·ªÉm** | **9/9** | **4/9** | **6/9** | **8/9** |

### K·∫øt lu·∫≠n

H·ªá th·ªëng **PhongTroATTT** ƒë√£ tri·ªÉn khai th√†nh c√¥ng **18 bi·ªán ph√°p b·∫£o m·∫≠t** to√†n di·ªán, tu√¢n th·ªß 100% OWASP Top 10 (2021) v√† √°p d·ª•ng ki·∫øn tr√∫c b·∫£o m·∫≠t ƒëa t·∫ßng (Defense in Depth).

**ƒêi·ªÉm n·ªïi b·∫≠t:**
- ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê B·∫£o m·∫≠t d·ªØ li·ªáu: M√£ h√≥a m·∫°nh m·∫Ω, HTTPS/TLS
- ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê B·∫£o m·∫≠t truy c·∫≠p: 2FA, RBAC, Account Lockout
- ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê B·∫£o m·∫≠t ki·∫øn tr√∫c: WAF, IP Filtering, CSRF
- ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Audit & Logging: Logs ƒë·∫ßy ƒë·ªß, Database Triggers
- ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Backup & Restore: Chi·∫øn l∆∞·ª£c backup 3 t·∫ßng

**M·ª©c ƒë·ªô b·∫£o m·∫≠t t·ªïng th·ªÉ: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5 sao)**

H·ªá th·ªëng ƒë√£ s·∫µn s√†ng tri·ªÉn khai trong m√¥i tr∆∞·ªùng production v·ªõi m·ª©c ƒë·ªô b·∫£o m·∫≠t cao, ƒë√°p ·ª©ng y√™u c·∫ßu c·ªßa c√°c ·ª©ng d·ª•ng web hi·ªán ƒë·∫°i.

---

## üìö T√ÄI LI·ªÜU THAM KH·∫¢O

1. OWASP Foundation (2021). *OWASP Top 10 - 2021*. https://owasp.org/Top10/
2. Django Software Foundation (2023). *Django Security*. https://docs.djangoproject.com/en/4.2/topics/security/
3. Microsoft (2023). *SQL Server Security Best Practices*. https://docs.microsoft.com/sql/
4. NIST (2018). *Framework for Improving Critical Infrastructure Cybersecurity*. https://www.nist.gov/cyberframework
5. PyOTP Contributors (2023). *PyOTP Documentation*. https://pyotp.readthedocs.io/

---

## üìû LI√äN H·ªÜ

**D·ª± √°n:** PhongTroATTT - H·ªá th·ªëng Qu·∫£n l√Ω Cho thu√™ Ph√≤ng tr·ªç v·ªõi B·∫£o m·∫≠t n√¢ng cao
**Ng√†y ho√†n th√†nh:** 25/12/2024
**Phi√™n b·∫£n:** 1.0
**GitHub:** https://github.com/phuonglatoi/phongtro-attt

---

**H·∫æT**
